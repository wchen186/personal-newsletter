<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Newsletter</title>
  <style>
    :root {
      --bg: #eef2f7;
      --surface: #fff;
      --surface2: #f8fafc;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #1d4ed8;
      --border: #dbe5f1;
      --shadow: 0 8px 22px rgba(15, 23, 42, 0.06);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, "Segoe UI", Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, #e9f0fb 0%, var(--bg) 45%, #f4f7fb 100%);
      line-height: 1.5;
    }
    .container { max-width: 1180px; margin: 0 auto; padding: 0 1rem; }
    header {
      background: radial-gradient(circle at top left, #1e3a8a, #0f172a 65%);
      color: #fff;
      padding: 1.25rem 0 1.1rem;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 5;
    }
    h1 { margin: 0; font-size: 1.4rem; }
    header p { margin: 0.4rem 0 0; color: #dbeafe; font-size: 0.95rem; }
    .toolbar { display: flex; gap: 0.7rem; align-items: center; margin-top: 0.8rem; flex-wrap: wrap; }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.6rem 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: #1e40af; }
    #status { color: #dbeafe; font-size: 0.88rem; }
    main { padding: 1rem 0 2rem; }
    section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1rem;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }
    section h2 {
      margin: 0 0 0.55rem;
      font-size: 1.1rem;
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.45rem;
    }
    .section-note { margin: 0 0 0.75rem; color: var(--muted); font-size: 0.9rem; }
    .grid { display: grid; gap: 0.9rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--surface2);
      padding: 0.85rem;
    }
    .card h3 { margin: 0 0 0.45rem; font-size: 1rem; }
    ul { margin: 0; padding-left: 1.15rem; }
    li { margin-bottom: 0.65rem; }
    a { color: #1e40af; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .muted { color: var(--muted); font-size: 0.9rem; }
    .meta { display: block; color: #334155; font-size: 0.78rem; margin-top: 0.2rem; }
    .tag {
      display: inline-block;
      background: #e0eaff;
      border: 1px solid #c7d7ff;
      border-radius: 999px;
      font-size: 0.72rem;
      font-weight: 600;
      padding: 0.06rem 0.44rem;
      margin-right: 0.35rem;
    }
    .spotlight-header {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .badge {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
      border-radius: 999px;
      padding: 0.12rem 0.55rem;
      font-size: 0.75rem;
      font-weight: 700;
    }
    footer { text-align: center; color: var(--muted); font-size: 0.82rem; padding-bottom: 1.2rem; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>My Personal Newsletter</h1>
      <p>Top discussions in baseball, job search, and business (headlines from the past 7 days).</p>
      <div class="toolbar">
        <button id="refreshBtn">Refresh Headlines</button>
        <span id="status">Loading...</span>
      </div>
    </div>
  </header>

  <main class="container">
    <section>
      <h2>Baseball</h2>
      <p class="section-note">Four league views. Each list merges many sources and keeps the top 3 most recent items from the last 7 days.</p>
      <div class="grid">
        <article class="card"><h3>MLB</h3><ul id="mlbList"><li class="muted">Loading MLB headlines...</li></ul></article>
        <article class="card"><h3>NPB</h3><ul id="npbList"><li class="muted">Loading NPB headlines...</li></ul></article>
        <article class="card"><h3>KBO</h3><ul id="kboList"><li class="muted">Loading KBO headlines...</li></ul></article>
        <article class="card"><h3>CPBL</h3><ul id="cpblList"><li class="muted">Loading CPBL headlines...</li></ul></article>
      </div>
    </section>

    <section>
      <h2>Job Search</h2>
      <div class="grid">
        <article class="card"><h3>Top Job Market Headlines</h3><ul id="jobSearchList"><li class="muted">Loading job-search headlines...</li></ul></article>
      </div>
    </section>

    <section>
      <h2>Business</h2>
      <div class="grid">
        <article class="card"><h3>Sports Business News</h3><ul id="sportsBizList"><li class="muted">Loading sports business headlines...</li></ul></article>
        <article class="card"><h3>General Business News</h3><ul id="businessList"><li class="muted">Loading general business headlines...</li></ul></article>
        <article class="card">
          <div class="spotlight-header">
            <h3 id="spotlightName">Company Spotlight</h3>
            <span class="badge">Daily Rotation</span>
          </div>
          <p id="spotlightIntro" class="muted"></p>
          <p><strong>Main services:</strong> <span id="spotlightServices"></span></p>
          <p><strong>Main revenue source:</strong> <span id="spotlightRevenue"></span></p>
          <p class="muted" id="spotlightSource"></p>
        </article>
      </div>
    </section>
  </main>

  <footer>
    This page aggregates many RSS/query sources (including WSJ and Reuters) and refreshes all sections daily.
  </footer>

  <script>
    function makeProxyUrls(rssUrl) {
      return [
        `https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`,
        `https://api.codetabs.com/v1/proxy/?quest=${encodeURIComponent(rssUrl)}`
      ];
    }

    function isWithinLastSevenDays(dateString) {
      const d = new Date(dateString);
      if (Number.isNaN(d.getTime())) return false;
      const now = new Date();
      const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      return d >= sevenDaysAgo && d <= now;
    }

    async function fetchFeedItems(rssUrl, sourceLabel) {
      const proxies = makeProxyUrls(rssUrl);
      let lastError = null;

      for (const proxyUrl of proxies) {
        try {
          const response = await fetch(proxyUrl);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          let xmlText = '';
          if (proxyUrl.includes('allorigins')) {
            const data = await response.json();
            xmlText = data.contents || '';
          } else {
            xmlText = await response.text();
          }

          if (!xmlText.trim()) throw new Error('Empty feed payload');

          const xml = new DOMParser().parseFromString(xmlText, 'text/xml');

          // Support both RSS (<item>) and Atom (<entry>) feeds.
          const rssItems = [...xml.querySelectorAll('item')].map(item => ({
            title: item.querySelector('title')?.textContent?.trim() || 'Untitled',
            link: item.querySelector('link')?.textContent?.trim() || '#',
            pubDate: item.querySelector('pubDate')?.textContent?.trim() || '',
            source: sourceLabel
          }));

          const atomItems = [...xml.querySelectorAll('entry')].map(entry => ({
            title: entry.querySelector('title')?.textContent?.trim() || 'Untitled',
            link: entry.querySelector('link')?.getAttribute('href') || '#',
            pubDate:
              entry.querySelector('published')?.textContent?.trim() ||
              entry.querySelector('updated')?.textContent?.trim() ||
              '',
            source: sourceLabel
          }));

          const items = [...rssItems, ...atomItems].filter(item => item.link && item.link !== '#');
          if (items.length) return items;
        } catch (error) {
          lastError = error;
        }
      }

      throw new Error(`Failed to fetch ${sourceLabel}: ${lastError ? lastError.message : 'unknown error'}`);
    }

    function renderHeadlines(listId, headlines) {
      const ul = document.getElementById(listId);
      ul.innerHTML = '';
      if (!headlines.length) {
        ul.innerHTML = '<li class="muted">No recent headlines available right now. Try Refresh in a moment.</li>';
        return;
      }

      headlines.forEach(item => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = item.link;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = item.title;
        const m = document.createElement('span');
        m.className = 'meta';
        const d = item.pubDate ? new Date(item.pubDate).toLocaleString() : 'Date not provided';
        m.innerHTML = `<span class="tag">${item.source}</span>${d}`;
        li.appendChild(a);
        li.appendChild(m);
        ul.appendChild(li);
      });
    }

    async function fetchCompanySummaryOnline(companyName) {
      const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(companyName)}`;
      const response = await fetch(url);
      if (!response.ok) throw new Error('Company summary fetch failed');
      const data = await response.json();
      return {
        name: data.title || companyName,
        intro: data.extract || 'No summary available right now.',
        source: data.content_urls?.desktop?.page || 'https://www.wikipedia.org/'
      };
    }

    const companyCandidates = [
      'TKO Group Holdings', 'Live Nation Entertainment', 'Endeavor Group Holdings', 'Madison Square Garden Sports',
      'Rogers Communications', 'Walt Disney Company', 'Comcast', 'Paramount Global', 'Warner Bros. Discovery',
      'Nintendo', 'Sony Group', 'Kakao Entertainment', 'Tencent', 'ByteDance', 'Naver', 'Krafton', 'Bandai Namco',
      'Take-Two Interactive', 'Electronic Arts', 'Netflix', 'Wynn Resorts', 'Caesars Entertainment', 'Liberty Media'
    ];

    async function renderDailySpotlight() {
      const index = Math.floor(Date.now() / 86400000) % companyCandidates.length;
      const companyName = companyCandidates[index];

      try {
        const summary = await fetchCompanySummaryOnline(companyName);
        document.getElementById('spotlightName').textContent = `Company Spotlight: ${summary.name}`;
        document.getElementById('spotlightIntro').textContent = summary.intro;
        document.getElementById('spotlightServices').textContent = 'See linked profile for current products, services, and segments.';
        document.getElementById('spotlightRevenue').textContent = 'Use latest annual report / investor relations for up-to-date revenue mix.';
        document.getElementById('spotlightSource').innerHTML = `Online source: <a href="${summary.source}" target="_blank" rel="noopener noreferrer">${summary.source}</a>`;
      } catch (error) {
        document.getElementById('spotlightName').textContent = `Company Spotlight: ${companyName}`;
        document.getElementById('spotlightIntro').textContent = 'Unable to load live company profile right now. Please refresh again shortly.';
        document.getElementById('spotlightServices').textContent = 'N/A';
        document.getElementById('spotlightRevenue').textContent = 'N/A';
        document.getElementById('spotlightSource').textContent = 'Live lookup temporarily unavailable.';
      }
    }

    const feeds = {
      mlbList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=MLB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'ESPN MLB', url: 'https://www.espn.com/espn/rss/mlb/news' },
        { label: 'CBS Sports MLB', url: 'https://news.google.com/rss/search?q=site:cbssports.com+MLB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Yahoo Sports MLB', url: 'https://news.google.com/rss/search?q=site:sports.yahoo.com+MLB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'The Athletic MLB', url: 'https://news.google.com/rss/search?q=site:theathletic.com+MLB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'MLB.com', url: 'https://www.mlb.com/feeds/news/rss.xml' }
      ],
      npbList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=NPB+baseball&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Japan Times NPB', url: 'https://news.google.com/rss/search?q=site:japantimes.co.jp+NPB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Kyodo NPB', url: 'https://news.google.com/rss/search?q=site:kyodonews.net+NPB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Mainichi NPB', url: 'https://news.google.com/rss/search?q=site:mainichi.jp+NPB&hl=en-US&gl=US&ceid=US:en' },
        { label: 'NHK NPB', url: 'https://news.google.com/rss/search?q=site:nhk.or.jp+NPB+baseball&hl=en-US&gl=US&ceid=US:en' }
      ],
      kboList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=KBO+League&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Korea JoongAng KBO', url: 'https://news.google.com/rss/search?q=site:koreajoongangdaily.joins.com+KBO&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Korea Times KBO', url: 'https://news.google.com/rss/search?q=site:koreatimes.co.kr+KBO&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Yonhap KBO', url: 'https://news.google.com/rss/search?q=site:yna.co.kr+KBO+baseball&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Naver KBO', url: 'https://news.google.com/rss/search?q=site:naver.com+KBO+baseball&hl=en-US&gl=US&ceid=US:en' }
      ],
      cpblList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=CPBL+baseball&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Focus Taiwan CPBL', url: 'https://news.google.com/rss/search?q=site:focustaiwan.tw+CPBL&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Taipei Times CPBL', url: 'https://news.google.com/rss/search?q=site:taipeitimes.com+CPBL&hl=en-US&gl=US&ceid=US:en' },
        { label: 'CNA CPBL', url: 'https://news.google.com/rss/search?q=site:en.cna.com.tw+CPBL&hl=en-US&gl=US&ceid=US:en' },
        { label: 'PTT CPBL', url: 'https://news.google.com/rss/search?q=PTT+CPBL&hl=en-US&gl=US&ceid=US:en' }
      ],
      jobSearchList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=job+search+career+advice&hl=en-US&gl=US&ceid=US:en' },
        { label: 'LinkedIn Jobs', url: 'https://news.google.com/rss/search?q=site:linkedin.com+jobs+career&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Indeed Career', url: 'https://news.google.com/rss/search?q=site:indeed.com+career+advice&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Glassdoor Blog', url: 'https://news.google.com/rss/search?q=site:glassdoor.com+career+advice&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Monster Career', url: 'https://news.google.com/rss/search?q=site:monster.com+career+advice&hl=en-US&gl=US&ceid=US:en' },
        { label: 'SHRM Jobs', url: 'https://news.google.com/rss/search?q=site:shrm.org+job+market&hl=en-US&gl=US&ceid=US:en' }
      ],
      sportsBizList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=sports+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'WSJ Sports Business', url: 'https://news.google.com/rss/search?q=site:wsj.com+sports+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Sports Business Journal', url: 'https://news.google.com/rss/search?q=site:sportsbusinessjournal.com&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Sportico', url: 'https://news.google.com/rss/search?q=site:sportico.com&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Front Office Sports', url: 'https://news.google.com/rss/search?q=site:frontofficesports.com&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Bloomberg Sports Business', url: 'https://news.google.com/rss/search?q=site:bloomberg.com+sports+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'CNBC Sports Business', url: 'https://news.google.com/rss/search?q=site:cnbc.com+sports+business&hl=en-US&gl=US&ceid=US:en' }
      ],
      businessList: [
        { label: 'Google News', url: 'https://news.google.com/rss/search?q=general+business+news&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Reuters Business', url: 'https://feeds.reuters.com/reuters/businessNews' },
        { label: 'NYTimes Business', url: 'https://rss.nytimes.com/services/xml/rss/nyt/Business.xml' },
        { label: 'BBC Business', url: 'https://feeds.bbci.co.uk/news/business/rss.xml' },
        { label: 'MarketWatch Top Stories', url: 'https://feeds.marketwatch.com/marketwatch/topstories/' },
        { label: 'CNBC Top News', url: 'https://search.cnbc.com/rs/search/combinedcms/view.xml?partnerId=wrss01&id=100003114' },
        { label: 'WSJ Business (Google index)', url: 'https://news.google.com/rss/search?q=site:wsj.com+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Bloomberg Business (Google index)', url: 'https://news.google.com/rss/search?q=site:bloomberg.com+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'Financial Times (Google index)', url: 'https://news.google.com/rss/search?q=site:ft.com+business&hl=en-US&gl=US&ceid=US:en' },
        { label: 'AP Business (Google index)', url: 'https://news.google.com/rss/search?q=site:apnews.com+business&hl=en-US&gl=US&ceid=US:en' }
      ]
    };

    async function refreshAllHeadlines() {
      const status = document.getElementById('status');
      status.textContent = 'Refreshing headlines...';

      const jobs = Object.entries(feeds).map(async ([listId, sourceList]) => {
        const settled = await Promise.allSettled(sourceList.map(s => fetchFeedItems(s.url, s.label)));
        const merged = settled
          .filter(r => r.status === 'fulfilled')
          .flatMap(r => r.value);

        const seen = new Set();
        const recent = [];
        const fallbackNoDate = [];

        for (const item of merged) {
          const key = `${item.title}|${item.link}`;
          if (seen.has(key)) continue;
          seen.add(key);

          if (item.pubDate && isWithinLastSevenDays(item.pubDate)) {
            recent.push(item);
          } else if (!item.pubDate) {
            fallbackNoDate.push(item);
          }
        }

        recent.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
        const combined = [...recent, ...fallbackNoDate].slice(0, 3);
        renderHeadlines(listId, combined);
      });

      await Promise.all(jobs);
      status.textContent = `Last updated: ${new Date().toLocaleString()} (past 7 days, live multi-source search)`;
    }

    function scheduleDailyRefresh() {
      const now = new Date();
      const next = new Date(now);
      next.setHours(24, 0, 5, 0);
      setTimeout(() => {
        renderDailySpotlight();
        refreshAllHeadlines();
        setInterval(() => {
          renderDailySpotlight();
          refreshAllHeadlines();
        }, 24 * 60 * 60 * 1000);
      }, next - now);
    }

    document.getElementById('refreshBtn').addEventListener('click', async () => {
      await renderDailySpotlight();
      await refreshAllHeadlines();
    });

    renderDailySpotlight();
    refreshAllHeadlines();
    scheduleDailyRefresh();
  </script>
</body>
</html>
